<?xml version='1.0' encoding='UTF-8'?>
<MorpheusModel version="4">
    <Description>
        <Title>Example-RunAndTumble</Title>
        <Details>Models a Levy walk - a random walk strategy that is superior for searching due to it's high spatial coverage.

Shows how to manipulate PropertyVectors (x,z,y) using the VectorRule. An expression for each of the three coordinates must be given, separated by a comma ",".</Details>
    </Description>
    <Global>
        <!--    <Disabled>
        <Variable symbol="angle" value="0.0"/>
    </Disabled>
-->
        <Constant symbol="dummy" value="0.0"/>
        <Constant symbol="target_vol" value="256.0"/>
        <!--    <Disabled>
        <Event trigger="when true" time-step="1.0">
            <Rule symbol-ref="Test_RN">
                <Expression>rand_norm(0,1)</Expression>
            </Rule>
        </Event>
    </Disabled>
-->
        <Constant symbol="cell_radii" value="sqrt(target_vol/pi)"/>
        <!--    <Disabled>
        <Field symbol="U" value="(l.x/size.x)" name="chemoatractant">
            <Diffusion rate="0"/>
        </Field>
    </Disabled>
-->
        <Constant symbol="epsilon" value="10.0"/>
    </Global>
    <Space>
        <Lattice class="square">
            <Size symbol="size" value="512 512 0"/>
            <Neighborhood>
                <Order>1</Order>
            </Neighborhood>
            <BoundaryConditions>
                <Condition boundary="x" type="periodic"/>
                <Condition boundary="y" type="periodic"/>
            </BoundaryConditions>
        </Lattice>
        <SpaceSymbol symbol="l"/>
    </Space>
    <Time>
        <StartTime value="1"/>
        <StopTime value="10000"/>
        <TimeSymbol symbol="time"/>
        <!--    <Disabled>
        <SaveInterval symbol="checkpoint" value="100"/>
    </Disabled>
-->
    </Time>
    <CellTypes>
        <CellType class="biological" name="amoeba">
            <VolumeConstraint target="pi*(sqrt(target_vol)/2)^2" strength="1"/>
            <SurfaceConstraint target="pi*sqrt(target_vol)" mode="surface" strength="0.2"/>
            <Property symbol="angle1" value="rand_norm(0,pi)"/>
            <!--    <Disabled>
        <Property symbol="c" value="0" name="Chemotactic strength"/>
    </Disabled>
-->
            <!--    <Disabled>
        <Chemotaxis field="U" strength="c"/>
    </Disabled>
-->
            <Constant symbol="persistance" value="1/5"/>
            <Constant symbol="D" value="pi/3"/>
            <Constant symbol="change_prob" value="rand_gamma(0,1)"/>
            <Constant symbol="phi" value="0.3"/>
            <Property symbol="theta" value="0.0"/>
            <!--    <Disabled>
        <Property symbol="friction" value="l.x/size.x"/>
    </Disabled>
-->
            <ConnectivityConstraint/>
            <Property symbol="angle" value="rand_norm(0,pi)"/>
            <PropertyVector symbol="move_dir" value="0, 0, 0"/>
            <DirectedMotion direction="move_dir" strength="0.4"/>
            <!--    <Disabled>
        <Function symbol="Test_RN">
            <Expression>rand_norm(0,1)</Expression>
        </Function>
    </Disabled>
-->
            <Event trigger="when true" time-step="1">
                <Condition>(abs(rand_norm(0,1)) >= 1.645) and (time>200)</Condition>
                <!--    <Disabled>
        <Rule symbol-ref="angle">
            <Expression>Test_RN</Expression>
        </Rule>
    </Disabled>
-->
                <Rule symbol-ref="angle">
                    <Expression>phi*angle + rand_norm(0,1)</Expression>
                </Rule>
                <VectorRule symbol-ref="move_dir">
                    <Expression>cos(angle), sin(angle), 0.0</Expression>
                </VectorRule>
            </Event>
            <!--    <Disabled>
        <Variable symbol="Test_RN" value="rand_norm(0,1)"/>
    </Disabled>
-->
            <!--    <Disabled>
        <Property symbol="Test_RN" value="rand_norm(0,1)"/>
    </Disabled>
-->
        </CellType>
        <CellType class="medium" name="medium"/>
        <!--    <Disabled>
        <CellType class="biological" name="amoeba2">
            <VolumeConstraint target="pi*(sqrt(target_vol)/2)^2" strength="1"/>
            <SurfaceConstraint target="pi*sqrt(target_vol)" mode="surface" strength="0.2"/>
            <Disabled>
                <Property symbol="c" value="0" name="Chemotactic strength"/>
            </Disabled>
            <Disabled>
                <Chemotaxis field="U" strength="c"/>
            </Disabled>
            <Property symbol="angle" value="rand_norm(1,0)"/>
            <Property symbol="angle1" value="rand_norm(1,0)"/>
            <Constant symbol="persistance" value="1/5"/>
            <Constant symbol="D" value="pi/3"/>
            <Constant symbol="change_prob" value="rand_gamma(0,1)"/>
            <Constant symbol="phi" value="0.95"/>
            <Property symbol="theta" value="0.0"/>
            <Disabled>
                <Property symbol="friction" value="l.x/size.x"/>
            </Disabled>
            <ConnectivityConstraint/>
            <Disabled>
                <Property symbol="angle1" value="rand_norm(0,pi)"/>
            </Disabled>
            <PropertyVector symbol="move_dir" value="0, 0, 0"/>
            <DirectedMotion direction="move_dir" strength="0.4"/>
            <Disabled>
                <Function symbol="Test_RN">
                    <Expression>rand_norm(0,1)</Expression>
                </Function>
            </Disabled>
            <Event trigger="when true" time-step="1">
                <Condition>(abs(rand_norm(0,1)) >= 1.645) and (time>450)</Condition>
                <Disabled>
                    <Rule symbol-ref="angle">
                        <Expression>Test_RN</Expression>
                    </Rule>
                </Disabled>
                <Rule symbol-ref="angle">
                    <Expression>-phi*sin(angle1-angle) + rand_norm(pi,1)</Expression>
                </Rule>
                <VectorRule symbol-ref="move_dir">
                    <Expression>cos(angle), sin(angle), 0.0</Expression>
                </VectorRule>
            </Event>
            <Disabled>
                <Variable symbol="Test_RN" value="rand_norm(0,1)"/>
            </Disabled>
            <Disabled>
                <Property symbol="Test_RN" value="rand_norm(0,1)"/>
            </Disabled>
        </CellType>
    </Disabled>
-->
    </CellTypes>
    <CPM>
        <Interaction>
            <Contact type1="amoeba" type2="medium" value="0.01"/>
            <!--    <Disabled>
        <Contact type1="amoeba" type2="amoeba2" value="-10"/>
    </Disabled>
-->
            <Contact type1="amoeba" type2="amoeba" value="-10"/>
        </Interaction>
        <MonteCarloSampler stepper="edgelist">
            <MCSDuration value="1"/>
            <Neighborhood>
                <Order>4</Order>
            </Neighborhood>
            <MetropolisKinetics temperature="2"/>
        </MonteCarloSampler>
        <ShapeSurface scaling="norm">
            <Neighborhood>
                <Distance>2.5</Distance>
            </Neighborhood>
        </ShapeSurface>
    </CPM>
    <CellPopulations>
        <Population size="0" type="amoeba">
            <InitCircle mode="random" number-of-cells="102">
                <Dimensions radius="1000.0" center="256, 256, 0.0"/>
            </InitCircle>
            <!--    <Disabled>
        <InitProperty symbol-ref="cell.volume">
            <Expression>50.0</Expression>
        </InitProperty>
    </Disabled>
-->
            <!--    <Disabled>
        <InitCellObjects mode="distance">
            <Arrangement repetitions="1, 1, 1" displacements="1, 1, 1">
                <Sphere radius="cell_radii" center="100, 256, 0.0"/>
            </Arrangement>
        </InitCellObjects>
    </Disabled>
-->
        </Population>
        <!--    <Disabled>
        <Population size="1" type="amoeba2">
            <InitCircle mode="random" number-of-cells="51">
                <Dimensions radius="1000.0" center="256, 256, 0.0"/>
            </InitCircle>
        </Population>
    </Disabled>
-->
    </CellPopulations>
    <Analysis>
        <Gnuplotter time-step="100" decorate="false">
            <Terminal name="png"/>
            <Plot>
                <Cells value="angle" min="0.0" max="6.28">
                    <ColorMap>
                        <Color value="6.28" color="red"/>
                        <Color value="4.71" color="yellow"/>
                        <Color value="3.14" color="green"/>
                        <Color value="1.57" color="blue"/>
                        <Color value="0.0" color="red"/>
                    </ColorMap>
                </Cells>
                <!--    <Disabled>
        <CellArrows orientation="5 * move_dir"/>
    </Disabled>
-->
                <!--    <Disabled>
        <Field symbol-ref="U"/>
    </Disabled>
-->
            </Plot>
        </Gnuplotter>
        <Logger time-step="1">
            <Input>
                <!--    <Disabled>
        <Symbol symbol-ref="l.x"/>
    </Disabled>
-->
                <Symbol symbol-ref="cell.center.x"/>
                <Symbol symbol-ref="cell.center.y"/>
                <Symbol symbol-ref="angle"/>
                <Symbol symbol-ref="cell_radii"/>
            </Input>
            <Output>
                <TextOutput/>
            </Output>
            <Plots>
                <Plot time-step="5000">
                    <Style style="lines" line-width="2.0"/>
                    <Terminal terminal="png"/>
                    <X-axis>
                        <Symbol symbol-ref="time"/>
                    </X-axis>
                    <Y-axis>
                        <Symbol symbol-ref="angle"/>
                    </Y-axis>
                </Plot>
            </Plots>
        </Logger>
    </Analysis>
</MorpheusModel>
